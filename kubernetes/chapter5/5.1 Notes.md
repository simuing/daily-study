# 5장 애플리케이션과 네트워크 연결하기

과거에는 애플리케이션을 한번 실행하면 다음 업데이트까지 종료하거나 노드를 바꾸지 않는 구조를 많이 사용했다. 이때는 일반적으로 네트워크상에서 다른 애플리케이션을 식별할 때 고정된 IP 주소와 포트를 사용한다.

이런 방식은 고정된 위치에 설치된 물리적인 서버를 사용하는 경우에 특히 선호되었다. 하지만 클라우드 서비스를 활용하여 애플리케이션을 배포하면서부터는 애플리케이션의 IP 주소를 고정시키기 어려워졌다. 이를 극복하기 위해 가상 IP를 부여하거나 별도의 네트워크 장치를 연결하는 방식 등이 활용 되기 시작했다.

**마이크로서비스 아키텍처(microservice architecture)**
특정한 기능을 가진 여러 개의 작은 서비스를 모아서 하나의 큰 서비스를 만들어내는 구조

<br/>

## 5.1 파드 내부의 컨테이너끼리 통신하기

지금까지 알아본 모든 파드는 컨테이너를 하나만 가지고 있었다. 예를 들면 다음과 같이 여러 개의 컨테이너를 실행할 수 있다.

```yaml
# chapter5/multi-container-pod.yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-multi-container-pod
spec:
  containers:
  - name: first-container
    image: first-app:1.0.0
    ports:
    - containerPort: 8080
  - name: second-container
    image: second-app:1.0.0
    ports:
    - containerPort: 3000 #컨테이너가 사용하는 포트는 파드 내에서 유일해야 한다.
```

<br/>

#### 여러 컨테이너로 구성된 파드

하나의 파드에 컨테이너를 여러 개 포함하는 것은 특별한 목적이 없다면 추천하는 구성은 아니다. 같은 파드에 포함된 컨테이너는 모든 라이프사이클을 공유하기 때문에 특정 컨테이너의 문제로 파드가 재시작하는 경우 다른 모든 컨테이너도 같이 재시작된다. 또 파드를 스케일링하여 숫자를 늘리거나 줄일 때도 모든 컨테이너의 수량이 같이 늘어나거나 줄어들기 때문에 효율적으로 스케일링하기 쉽지 않다.

따라서 하나의 파드에 여러 컨테이너를 구성하는 경우에는 그 파드의 목적에 맞는 주 컨테이너와 그 컨테이너에 종속된 보조 컨테이너를 구분하는 것이 좋다. 이와 같은 구성을 사이드카 패턴(sidecar pattern)이라고 한다. 예를 들면 애플리케이션을 하나의 컨테이너로 파드에 포함시키고, 그 애플리케이션의 로그를 수집하기 위한 로그 수집기를 별도 컨테이너로 같은 파드에서 실행하도록 구성할 수 있다.

이때, 파드의 활성 프로브를 애플리케이션 쪽으로 지정해서 파드의 라이프사이클을 애플리케이션의 라이프사이클과 일치시킨다. 그러지 않으면 애플리케이션이 비정상적으로 종료 되어도 보조 컨테이너들이 살아 있어 파드가 재시작하지 않는 문제가 발생할 수 있다.


<br/>

파드는 쿠버네티스에서 다루는 가장 작은 단위의 오브젝트이기 때문에 쪼개지지 않는 특성을 가지고 있다. 쪼개어지지 않는다는 말은 다시 말해서 같은 파드에 속해 있는 컨테이너들은 모두 물리적으로 같은 노드에서 실행된다는 말이다.

그리고 하나의 파드에서 여러 개의 컨테이너를 실행할 경우 모든 컨테이너는 저장공간과 네트워크 인터페이스를 공유한다. 이는 개발자들이 자신의 로컬 환경에서 여러 개의 애플리케이션을 실행할 때와 동일한 동작이다.

